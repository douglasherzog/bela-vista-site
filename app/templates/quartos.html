{% extends "base.html" %}
{% block title %}Apartamentos — {{ (site and site.nome_site) or 'Motel Bela Vista' }}{% endblock %}
{% block content %}
  <h1 style="margin:0 0 12px">Apartamentos</h1>
  <div class="card" style="margin:0 0 16px">
    <h2 style="margin:0 0 10px">Tabela de preços</h2>
    <div class="scroll-hint">Posicione na tabela de preços e aguarde rolar para o lado para ver os valores da suíte com hidromassagem, ou então role manualmente.</div>
    <div class="table-wrap">
      <table class="price-table">
        <thead>
          <tr style="text-align:left; color:#a9b9d4">
            <th style="padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08)">Tempo de permanência</th>
            <th style="padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08)">Apartamento</th>
            <th style="padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08)">Suíte</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding:10px 10px">Até 1h</td>
            <td style="padding:10px 10px">R$ 85,00</td>
            <td style="padding:10px 10px">R$ 130,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 1h a 1h30</td>
            <td style="padding:10px 10px">R$ 110,00</td>
            <td style="padding:10px 10px">R$ 160,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 1h30 a 2h</td>
            <td style="padding:10px 10px">R$ 145,00</td>
            <td style="padding:10px 10px">R$ 190,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 2h a 2h30</td>
            <td style="padding:10px 10px">R$ 160,00</td>
            <td style="padding:10px 10px">R$ 220,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 2h30 a 3h</td>
            <td style="padding:10px 10px">R$ 180,00</td>
            <td style="padding:10px 10px">R$ 235,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 3h a 3h30</td>
            <td style="padding:10px 10px">R$ 195,00</td>
            <td style="padding:10px 10px">R$ 250,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 3h30 a 4h</td>
            <td style="padding:10px 10px">R$ 220,00</td>
            <td style="padding:10px 10px">R$ 280,00</td>
          </tr>
          <tr>
            <td style="padding:10px 10px">De 4h a 12h (Pernoite)</td>
            <td style="padding:10px 10px">R$ 240,00</td>
            <td style="padding:10px 10px">R$ 320,00</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="subtitle" style="margin-top:10px">Valores válidos para casal.</div>
  </div>

  <script>
    (function(){
      try {
        if (!window.matchMedia || !window.matchMedia('(max-width: 640px)').matches) return;
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        var wrap = document.querySelector('.table-wrap');
        if (!wrap) return;
        var stopped = false;
        function stop(){ stopped = true; }
        wrap.addEventListener('touchstart', stop, {passive:true});
        wrap.addEventListener('touchmove', stop, {passive:true});
        wrap.addEventListener('wheel', stop, {passive:true});

        function animate(from, to, duration, done){
          var start = null;
          function step(ts){
            if (stopped) return;
            if (start === null) start = ts;
            var t = Math.min(1, (ts - start) / duration);
            var eased = t < 0.5 ? (2*t*t) : (1 - Math.pow(-2*t + 2, 2)/2);
            wrap.scrollLeft = from + (to - from) * eased;
            if (t < 1) requestAnimationFrame(step); else if (done) done();
          }
          requestAnimationFrame(step);
        }

        function runOnce(){
          if (stopped) return;
          var max = wrap.scrollWidth - wrap.clientWidth;
          if (max <= 16) return;
          animate(0, max, 2600, function(){
            if (stopped) return;
            setTimeout(function(){ animate(max, 0, 2600); }, 500);
          });
        }

        var ran = false;
        var io = new IntersectionObserver(function(entries){
          if (ran) return;
          for (var i=0;i<entries.length;i++){
            if (entries[i].isIntersecting){
              ran = true;
              runOnce();
              try { io.disconnect(); } catch(e) {}
              break;
            }
          }
        }, {threshold: 0.35});
        io.observe(wrap);
      } catch(e) {}
    })();
  </script>

  <div class="card">
    <h2 style="margin:0 0 10px">Fotos dos apartamentos</h2>
    {% if fotos_apartamentos and fotos_apartamentos|length %}
      <div style="display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:8px">
        {% for foto in fotos_apartamentos %}
          <img src="{{ foto.thumb }}" srcset="{{ foto.srcset }}" sizes="(max-width: 640px) 100vw, 33vw" alt="Apartamento" style="width:100%; height:160px; object-fit:cover; border-radius:10px" loading="lazy" />
        {% endfor %}
      </div>
    {% else %}
      <p class="subtitle">Adicione imagens na pasta <strong>fotos_apartamentos/</strong> para aparecerem aqui.</p>
    {% endif %}
  </div>
{% endblock %}
